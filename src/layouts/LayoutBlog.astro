---
import Layout from "./Layout.astro";
import PostHeader from "../components/PostHeader.astro";
import PostContent from "../components/PostContent.astro";
import BotonesNav from "../components/BotonesNav";
import { formatearBlogPost } from "../utils/AppConfig";
import PostRelacionados from "../components/PostRelacionados.astro";
import Section from "../components/Section.astro";
import DonarPaypal from "../components/DonarPaypal.astro";
import PerfilAutor from "../components/PerfilAutor.astro";
import TablaDeContenido from "../components/TablaDeContenido.astro";
import NativeBanner from "../components/NativeBanner.astro";

const { frontmatter, headings } = Astro.props;

const allPosts = await Astro.glob("../pages/idea/*.md");
const postFormateado = formatearBlogPost(allPosts);

const publicacionesRelacionadas = postFormateado
  .filter(
    (post: any) =>
      post.frontmatter.categoria.toLowerCase() ===
        frontmatter.categoria.toLowerCase() &&
      post.frontmatter.title.toLowerCase() !== frontmatter.title.toLowerCase()
  )
  .slice(0, 3);
---

<Layout
  metatitle={frontmatter.metatitle}
  metadescription={frontmatter.metadescription}
  slug={frontmatter.slug}
>
  <div class="flex flex-col md:flex-row">
    <div class="mx-auto">
      <PostHeader
        title={frontmatter.title}
        pubDate={frontmatter.pubDate}
        author={frontmatter.author}
        categoria={frontmatter.categoria}
        img={{ src: frontmatter.image.src, alt: frontmatter.image.alt }}
      />
      <div class="grid grid-cols-2 md:grid-cols-4">
        <BotonesNav client:load />
      </div>
      <Section>
        <div class="grid grid-col md:grid-cols-2">
          <div id="accordion-collapse" data-accordion="collapse">
            <h2 id="accordion-collapse-heading-1">
              <button
                type="button"
                class="flex items-center justify-between w-full p-5 font-medium rtl:text-right border border-b-0 border-gray-200 rounded-t-xl focus:ring-4 focus:ring-gray-200 gap-3"
                data-accordion-target="#accordion-collapse-body-1"
                aria-expanded="true"
                aria-controls="accordion-collapse-body-1"
              >
                <span class="text-lg">Tabla de contenido</span>
                <svg
                  data-accordion-icon
                  class="w-3 h-3 rotate-180 shrink-0"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 10 6"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5 5 1 1 5"></path>
                </svg>
              </button>
            </h2>
            <div
              id="accordion-collapse-body-1"
              class="hidden"
              aria-labelledby="accordion-collapse-heading-1"
            >
              <TablaDeContenido headings={headings} />
            </div>
          </div>
          <div class="container">
            <NativeBanner />
          </div>
        </div>
      </Section>

      <PostContent><slot /></PostContent>
    </div>
  </div>
  <Section>
    <h3 class="text-gray-600 text-center mb-2 text-6xl md:text-2xl">
      Publicaciones Relacionadas
    </h3>
    <div class="container flex flex-col md:flex-row gap-1">
      {
        publicacionesRelacionadas.length > 0 && (
          <PostRelacionados {publicacionesRelacionadas} />
        )
      }
    </div>
  </Section>
  <div class="flex flex-col md:flex-row gap-1">
    <PerfilAutor />
    <DonarPaypal />
  </div>
</Layout>
